<!DOCTYPE html>
<html>
<head>
  <script src="eeg32.js"></script>
  <script src="gpu-browser.min.js" charset="UTF-8"></script>
  <script src="gpuJSUtils.js"></script>
</head>
<body>
<p>
  Enable the experimental web platform features flag in chrome://flags and restart chrome if you haven't. <br>
  Open the console, type EEG.setupSerialAsync() to connect to the data stream with the EEG plugged in. <br>
  Check EEG.data for decoded data <br>
  If it returns true it decoded a line successfully into EEG.data :-)
</p>
<hr>

<script>


  if(!navigator.serial){
      alert("navigator.serial not found! Enable #enable-experimental-web-platform-features in chrome://flags (search 'experimental')");
  }
  else{
      alert("FYI I only got this working for the FreeEEG32 in Ubuntu so far!!!");
  }

  try { var EEG = new eeg32(); }
  catch { alert("eeg32.js not found, make sure it's in the same folder as this html file!!!") }

  try {
  
    var GPU = new gpuUtils();

    var nChannels = 32; //Number of channels to sample
    var sps = 512; //Samples per second
    var nSec = 1; //Number of seconds to sample
    var freqStart = 0; //Beginning of DFT frequencies
    var freqEnd = 100; //End of DFT frequencies (max = SPS * 0.5, half the nyquist sampling rate)

    var posMagsList = []; // amplitudes (y-axis)
    var bandPassWindow = GPU.bandPassWindow(freqStart,freqEnd,sps); // frequencies (x-axis)

    var analyzeEEG = () => {
      var buffer = [];
      var ct = EEG.data.counter;
      for(var i = 0; i < channels; i++){
        var channel = "A"+i
        buffer.push(EEG.data[channel].slice(EEG.data.counter - sps, EEG.data.counter));
      }
      posMagsList = GPU.MultiChannelDFT_BandPass(buffer, 1, freqStart, freqEnd);

      setTimeout(()=>{requestAnimationFrame(analyzeEEG);},100); //Hard fps limit
    }
  }
  catch{ alert("gpu.js utils error"); }


</script>
</body>
</html>
